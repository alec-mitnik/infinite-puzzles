<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="Play an endless supply of dynamically-generated puzzle games in this web app by Alec Mitnik.">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, viewport-fit=cover" />
<meta name="msapplication-TileImage" content="images/infinite-puzzles-icon-144.png" />
<meta name="msapplication-TileColor" content="#0062A5"/>
<meta name="theme-color" content="#333333" />

<title>Infinite Puzzles</title>

<link rel="manifest" crossorigin="use-credentials" href="manifest.json" />
<link rel="apple-touch-icon" href="images/infinite-puzzles-icon-180.png" />
<!-- Better to just use the ico file, since with PNGs, PC browsers use the 32x32 one despite rendering at 16x16 -->
<!-- <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"> -->
<link rel="stylesheet" href="styles.css" />

<!-- https://github.com/catdad/canvas-confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<!-- Uncomment for testing local storage failure -->
<!-- <script>
  delete window.localStorage;
  Object.defineProperty(window, 'localStorage', {
    configurable: true,
    get() {
      throw new DOMException('Blocked for testing', 'SecurityError');
    }
  });
</script> -->

<!-- The IDE has way better support for JavaScript in js files than in html files -->
<script type="module" src="./js/main.js"></script>
</head>

<body class="loading">
  <section id="settings" class="menu-primary sidebar-group" role="group" aria-label="Puzzle Settings">
    <div class="sidebar submenu-primary">
      <!-- Volume -->
      <button aria-label="Mute Sounds" id="muteButton">
        <span id="soundIcon" role="img" aria-label="Mute Sounds">üîä</span>
        <span id="noSoundIcon"role="img" aria-label="Unmute Sounds">üîà</span>
      </button>

      <div id="difficulty-group" role="radiogroup" aria-label="Puzzle Difficulty">
        <!-- At Ease -->
        <label id="difficulty1" class="faded">
          <input type="radio" name="difficulty" aria-label="Quick" />
          <span aria-hidden="true">üòã</span>
        </label>
        <!-- Thinking -->
        <label id="difficulty2" class="faded">
          <input type="radio" name="difficulty" aria-label="Casual" />
          <span aria-hidden="true">ü§î</span>
        </label>
        <!-- Bracing -->
        <label id="difficulty3" class="faded">
          <input type="radio" name="difficulty" aria-label="Challenging" />
          <span aria-hidden="true">üò§</span>
        </label>
        <!-- Mind Blown -->
        <label id="difficulty4" class="faded">
          <input type="radio" name="difficulty" aria-label="Intense" />
          <span aria-hidden="true">ü§Ø</span>
        </label>
      </div>

      <!-- Fullscreen -->
      <button aria-label="Enter Fullscreen Mode" id="fullScreenButton">
        <span id="fullScreenOnIcon" role="img" aria-label="Enter Fullscreen Mode">üì±</span>
        <span id="fullScreenOffIcon" role="img" aria-label="Exit Fullscreen Mode">üì¥</span>
      </button>
    </div>

    <div id="homeSubmenu" class="sidebar submenu-secondary">
      <!-- Portfolio Link -->
      <div id="portfolio-link-wrapper">
        <a id="portfolio-link" style="display: none;" href="https://alec-mitnik.github.io/" target="_blank" rel="author" aria-label="Check out my other projects">
          <img loading="lazy" src="./images/PXL_Avatar_1B.jpg" alt="Check out my other projects" />
        </a>
      </div>

      <!-- Daily Challenge -->
      <button id="dailyChallengeButton" aria-label="Daily Challenge"
          aria-describedby="dailyChallengeCountdown">
        <span role="img" aria-label="Daily Challenge">
          <span id="dailyChallengeIcon" aria-hidden="true" class="faded">üèÜ</span>
          <span class="dailyChallengeCountdownWrapper">
            <span id="dailyChallengeCountdown"></span>
          </span>
        </span>
      </button>

      <!-- Puzzle Stats -->
      <button aria-label="Puzzle Stats" id="statsButton">
        <span role="img" aria-label="Puzzle Stats">üìä</span>
      </button>
    </div>
  </section>

  <!-- Daily Challenge Dialog -->
  <dialog id="dailyChallengeDialog" aria-labelledBy="dailyChallengeDialogTitle">
    <div class="dialog-inner-wrapper">
      <div class="modal-backdrop" aria-hidden="true"
          onclick="document.getElementById('dailyChallengeDialog').close()"></div>
      <div class="modal-foreground">
        <button autofocus class="close-button" aria-label="Close dialog"
            onclick="document.getElementById('dailyChallengeDialog').close()">
          <span aria-hidden="true"></span>
        </button>

        <div class="modal-content" tabindex="-1">
          <h1 id="dailyChallengeDialogTitle">Daily Challenge</h1>

          <div class="scroll-container">
            <p id="dailyChallengeExplanation" class="smaller-text">
              A short sequence of puzzles, increasing in difficulty, identical for everyone.  Your total time will be recorded, so you can track and compare with others.  Come back each day for a new challenge!
            </p>

            <h2 id="dailyChallengeDialogDate"></h2>
            <div id="dailyChallengeDialogPuzzles"></div>

            <p id="dailyChallengeRecommendation" class="smaller-text">
              It's strongly recommended to become familiar with each puzzle first.
            </p>
            <div id="dailyChallengeCompletedContent">
              <p id="dailyChallengeCompletedMessage"></p>
              <p id="dailyChallengeJustCompletedMessage"></p>
              <button id="dailyChallengeShareResultButton">Share Your Result</button>
            </div>
            <p class="local-storage warning hidden">
              Warning: local storage unavailable.  Data will not persist!
            </p>

            <hr />

            <details id="dailyChallengeAdditionalDetails">
              <summary aria-describedby="dailyChallengeAdditionalDetailsList">
                <h2 id="dailyChallengeAdditionalDetailsHeader">Additional Details</h2>
              </summary>

              <ul id="dailyChallengeAdditionalDetailsList"
                  aria-labelledby="dailyChallengeAdditionalDetailsHeader">
                <li>
                  The recorded time will begin when you first start the challenge and end when you have completed all of its puzzles.
                  <ul>
                    <li>You can exit and resume the daily challenge as you like, and it will remember completed puzzles, but not any partial puzzle progress.</li>
                    <li>You have until the new day starts.  If you don't finish the challenge by then, your streak will end.</li>
                  </ul>
                </li>
                <li>Difficulty for daily challenge puzzles is predetermined, so the difficulty selection for them is disabled.</li>
                <li>Data is saved to your browser's local storage and can be tracked in the Puzzle Stats menu.</li>
                <li>
                  While playing a daily challenge puzzle, until it's completed:
                  <ul>
                    <li>Using the middle mouse button to peek at the solution is disabled.</li>
                    <li>If you want to give up the challenge attempt and just see the solution, you can select the button to peek at it and confirm, but note that this will end your current streak.</li>
                  </ul>
                </li>
              </ul>
            </details>

            <hr />

            <div id="dailyChallengeDialogControls">
              <label id="showDailyChallengeTimerLabel" class="smaller-text">
                <input id="showDailyChallengeTimerCheckbox" type="checkbox" />
                Show Timer
              </label>

              <button id="startDailyChallengeButton"></button>
            </div>

            <p id="replayDailyChallengeNote" class="smaller-text">
              Replays are not timed - only your first attempt is recorded.
            </p>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Stats Dialog -->
  <dialog id="statsDialog" aria-labelledBy="statsDialogTitle">
    <div class="dialog-inner-wrapper">
      <div class="modal-backdrop" aria-hidden="true"
          onclick="document.getElementById('statsDialog').close()"></div>
      <div class="modal-foreground">
        <button autofocus class="close-button" aria-label="Close dialog"
            onclick="document.getElementById('statsDialog').close()">
          <span aria-hidden="true"></span>
        </button>

        <div class="modal-content" tabindex="-1">
          <h1 id="statsDialogTitle">Puzzle Stats</h1>

          <div class="scroll-container">
            <p class="local-storage warning hidden">
              Warning: local storage unavailable.  Data will not persist!
            </p>

            <section aria-labelledBy="statsGeneralTitle">
              <h2 id="statsGeneralTitle">General Stats</h2>

              <dl class="statsGrid" aria-labelledBy="statsGeneralTitle">
                <div class="full-row">
                  <dt id="tutorialsCompletedTerm">Tutorials Completed</dt>
                  <dd>
                    <ul id="statTutorialsCompletedValue" aria-labelledBy="tutorialsCompletedTerm">

                    </ul>
                  </dd>
                </div>

                <div>
                  <dt>Most Played</dt>
                  <dd id="statFavoritePuzzlesValue"></dd>
                </div>

                <div>
                  <dt>Greatest Mastery</dt>
                  <dd id="statGreatestMasteryValue"></dd>
                </div>
              </dl>
            </section>

            <section aria-labelledBy="statsDailyChallengeTitle">
              <h2 id="statsDailyChallengeTitle">Daily Challenge Stats</h2>

              <dl class="statsGrid" aria-labelledBy="statsDailyChallengeTitle">
                <div>
                  <dt>Current Streak</dt>
                  <dd id="statDailyChallengeStreakValue"></dd>
                </div>

                <div>
                  <dt>Longest Streak</dt>
                  <dd id="statLongestDailyChallengeStreakValue"></dd>
                </div>

                <div>
                  <dt>Total Completed</dt>
                  <dd id="statTotalDailyChallengesCompletedValue"></dd>
                </div>

                <div>
                  <dt>Fastest Completion</dt>
                  <dd id="statFastestDailyChallengeCompletionValue"></dd>
                </div>
              </dl>
            </section>

            <hr />

            <details id="dailyChallengeArchiveDetails">
              <summary>
                <h2 id="dailyChallengeArchiveHeader">Past Daily Challenges</h2>
              </summary>

              <p class="smaller-text">
                Note that replays are not timed or recorded.
              </p>

              <ul id="dailyChallengeArchiveList"
                  aria-labelledby="dailyChallengeArchiveHeader">
              </ul>

              <div id="callToAction" style="display: none;">
                <h2>Enjoying the App?</h2>
                <p class="smaller-text">
                  This is a passion project that I put a lot of work into and provide entirely for free without ads.  If you like Infinite Puzzles, please consider showing your support by visiting my <a
                  href="https://alec-mitnik.github.io/" target="_blank" rel="author">
                    portfolio site</a>, where you can:
                </p>

                <ul>
                  <li><span aria-hidden="true">üëÄ</span> Check out my other projects</li>
                  <li><span aria-hidden="true">‚úâÔ∏è</span> Email me your thoughts or feedback</li>
                  <li><span aria-hidden="true">ü´∂</span> Make a (much appreciated) donation</li>
                </ul>
              </div>
            </details>

            <hr />

            <button id="resetDataButton">Reset Data</button>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <main id="canvasContainer">
    <canvas id="puzzleCanvas" tabindex="0" aria-label="Puzzle Canvas" oncontextmenu="return false;"></canvas>

    <button disabled id="startButton" aria-label="Start Puzzle">
      <span></span>
    </button>
  </main>

  <!-- Icons are given &#xFE0E; modifier to show as text version for PC
  (but still as emoji version for mobile) -->

  <!-- Put more intuitive puzzles at the top/left -->
  <nav id="puzzleGames" class="menu-secondary sidebar-group" aria-label="Puzzle Games">
    <div class="puzzleLinks sidebar submenu-primary">
      <button aria-label="Tetromino Grid Puzzle">
        <span role="img" aria-Label="Tetromino Grid Puzzle">üî≤Ô∏é</span>
      </button>
      <button aria-label="Arithmetic Grid Puzzle">
        <span role="img" aria-Label="Arithmetic Grid Puzzle">üìùÔ∏é</span>
      </button>
      <button aria-label="Tangled Graph Puzzle">
        <span role="img" aria-Label="Tangled Graph Puzzle">üï∏Ô∏é</span>
      </button>
      <button aria-label="Logic Grid Puzzle">
        <span role="img" aria-Label="Logic Grid Puzzle">üí≠Ô∏é</span>
      </button>
      <button aria-label="Shifting Grid Puzzle">
        <span role="img" aria-Label="Shifting Grid Puzzle">üöÇÔ∏é</span>
      </button>
      <button aria-label="Color Pieces Grid Puzzle">
        <span role="img" aria-Label="Color Pieces Grid Puzzle">üèÅÔ∏é</span>
      </button>
    </div>

    <div class="puzzleLinks sidebar submenu-secondary">
      <button aria-label="Light Switches Puzzle">
        <span role="img" aria-Label="Light Switches Puzzle">üö®Ô∏é</span>
      </button>
      <button aria-label="Slider Path Puzzle">
        <span role="img" aria-Label="Slider Path Puzzle">üö©Ô∏é</span>
      </button>
      <button aria-label="Emitters Grid Puzzle">
        <span role="img" aria-Label="Emitters Grid Puzzle">üìªÔ∏é</span>
      </button>
      <button aria-label="Grid Mirror Puzzle">
        <span role="img" aria-Label="Grid Mirror Puzzle">üîÜÔ∏é</span>
      </button>
      <button aria-label="Circuit Grid Puzzle">
        <span role="img" aria-Label="Circuit Grid Puzzle">üîåÔ∏é</span>
      </button>
      <button aria-label="Marked Loop Puzzle">
        <span role="img" aria-Label="Marked Loop Puzzle">üíçÔ∏é</span>
      </button>
    </div>
  </nav>

  <div id="controls" class="menu-secondary sidebar hidden" role="group" aria-label="Puzzle Controls">
    <!-- Home -->
    <button aria-label="Home" id="homeButton">
      <span role="img" aria-Label="Home">&#10094;</span>
    </button>
    <!-- Toggle Tutorial -->
    <button aria-label="Start Tutorial" class="larger" id="tutorialButton">
      <span role="img" aria-Label="Start Tutorial">&#9883;&#xFE0E;</span>
    </button>
    <!-- Instructions -->
    <button aria-label="Show Instructions" class="larger" id="instructionsButton">
      <span role="img" aria-Label="Show Instructions">?</span>
    </button>
    <!-- Daily Challenge Timer -->
    <div id="dailyChallengeControlsTimerWrapper">
      <span class="dailyChallengeCountdownWrapper">
        <span id="dailyChallengeTimer"></span>
      </span>
    </div>
    <!-- Show Solution -->
    <button aria-label="Show Solution" class="larger" id="solutionButton">
      <span role="img" aria-Label="Show Solution">&#9745;&#xFE0E;</span>
    </button>
    <!-- Generate New Puzzle -->
    <button aria-label="Generate New Puzzle" class="larger" id="generateNewPuzzleButton">
      <span role="img" aria-Label="Generate New Puzzle">&#8634;</span>
    </button>
    <!-- Next Tutorial Puzzle -->
    <button aria-label="Next Tutorial Puzzle" class="hidden" id="nextTutorialPuzzleButton">
      <span role="img" aria-Label="Next Tutorial Puzzle">&#9197;&#xFE0E;</span>
    </button>
    <!-- Next Daily Challenge Puzzle -->
    <button aria-label="Next Daily Challenge Puzzle" id="nextDailyChallengePuzzleButton">
      <span role="img" aria-Label="Next Daily Challenge Puzzle">&#9197;&#xFE0E;</span>
    </button>
    <!-- Open Puzzle Sharing Dialog -->
    <button aria-label="Open Puzzle Sharing Dialog" class="much-larger" id="sharePuzzleButton">
      <span role="img" aria-Label="Open Puzzle Sharing Dialog">&#9010;</span>
    </button>
  </div>

  <!-- Puzzle Sharing Dialog -->
  <dialog id="puzzleSharingDialog" aria-labelledBy="sharePuzzleTitle">
    <div class="dialog-inner-wrapper">
      <div class="modal-backdrop" aria-hidden="true"
          onclick="document.getElementById('puzzleSharingDialog').close()"></div>
      <div class="modal-foreground">
        <button autofocus class="close-button" aria-label="Close dialog"
            onclick="document.getElementById('puzzleSharingDialog').close()">
          <span aria-hidden="true"></span>
        </button>

        <div class="modal-content" tabindex="-1">
          <h1 id="sharePuzzleTitle">Puzzle Sharing</h1>

          <p id="sharePuzzleTutorialMessage">
            You can share generated puzzles once you exit the tutorial!
          </p>

          <div id="sharePuzzleOptions" class="scroll-container">
            <p class="smaller-text">
              Puzzles are generated from seed text, which means you can share this specific generated puzzle with others using the options below!
            </p>

            <h2>
              Current Puzzle Sharable URL:
            </h2>
            <code id="sharePuzzleUrl" class="link-text"></code><br />

            <button id="sharePuzzleLinkWithNavigatorButton">Share Link to Current Puzzle</button>

            <hr />

            <details id="sharePuzzleSeedDirectlyDetails">
              <summary><h2>Share Puzzle Seed Directly</h2></summary>

              <p>
                Current Puzzle Seed: <code id="sharePuzzleSeed"></code>
              </p>

              <button id="sharePuzzleSeedWithNavigatorButton">Share Puzzle Seed</button>

              <p>
                When sharing this seed directly, the recipient needs to do the following:
              </p>
              <ol aria-label="Share Puzzle Seed Instructions">
                <li>Open the <span id="seedInstructionsTitles"></span></li>
                <li>Set the difficulty to: <span id="seedInstructionsDifficultyEmoji"
                    aria-hidden="true"></span> (<span id="seedInstructionsDifficultyLabel"></span>)</li>
                <li>Bring up this Puzzle Sharing dialog</li>
                <li>Use the form below to generate a puzzle from the seed</li>
              </ol>
            </details>

            <hr />

            <form id="generatePuzzleFromSeedForm">
              <label for="generateFromSeedInput">
                <h2>Generate Puzzle from Seed</h2>
              </label>

              <input id="generateFromSeedInput" type="text" name="newSeed" size="14" placeholder="Seed..."
                  required  pattern="[a-zA-Z0-9]*" maxlength="14"
                  spellcheck="false" autocomplete="off" />
              <button type="submit">Generate</button>

              <p class="smaller-text">
                Use this for any puzzle seeds directly shared with you.  You can also have everyone agree on a new seed to generate from in order to all play the same puzzle that way.
              </p>
            </form>
          </div>
        </div>
      </div>
    </div>
  </dialog>
</body>
</html>
